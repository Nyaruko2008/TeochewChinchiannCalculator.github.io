<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊΩÆÊ±ïË¶™Â±¨Á®±Ë¨ÇË®àÁÆóÂô®</title>
    <style>
        /* ÂºïÂÖ•Ëá™ÂÆöÁæ©Â≠óÈ´î */
        @font-face {
            font-family: 'ShangguSerif';
            src: url('fonts/ShangguSerif-ExtraLight.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --bg-color: #f0f2f5;
            --calculator-bg: #ffffff;
            --display-bg: #f9f9f9;
            --text-color: #333;
            --result-color: #d9534f;
            --button-bg: #e9ecef;
            --button-hover-bg: #dee2e6;
            --operator-bg: #adb5bd;
            --operator-hover-bg: #9fa8b1;
            --equal-bg: #007bff;
            --equal-hover-bg: #0069d9;
        }

        /* Ê∑±Ëâ≤Ê®°ÂºèËÆäÊï∏ */
        body.dark-mode {
            --bg-color: #121212;
            --calculator-bg: #1f1f1f;
            --display-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --result-color: #ff6b6b;
            --button-bg: #363636;
            --button-hover-bg: #4a4a4a;
            --operator-bg: #616161;
            --operator-hover-bg: #757575;
            --equal-bg: #4da6ff;
            --equal-hover-bg: #3385ff;
        }

        /* Ëá™ÂãïÂåπÈÖçÁ≥ªÁµ±‰∏ªÈ°å */
        @media (prefers-color-scheme: dark) {
            body:not(.light-mode) {
                --bg-color: #121212;
                --calculator-bg: #1f1f1f;
                --display-bg: #2d2d2d;
                --text-color: #e0e0e0;
                --result-color: #ff6b6b;
                --button-bg: #363636;
                --button-hover-bg: #4a4a4a;
                --operator-bg: #616161;
                --operator-hover-bg: #757575;
                --equal-bg: #4da6ff;
                --equal-hover-bg: #3385ff;
            }
        }
        
        /* ÈáùÂ∞çÂ∏∂Èü≥Ê®ô‰∫ìÊñáÂ≠óÈÄ≤Ë°åÂæÆË™ø */
        ruby rt {
            font-size: 0.5em; /* Ë™øÊï¥Ê≥®Èü≥Â§ßÂ∞è */
            line-height: 1;
            color: #888;
        }

        body {
            font-family: 'ShangguSerif', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            perspective: 1000px;
            transition: background-color 0.3s, color 0.3s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .calculator-container {
            width: 100%;
            max-width: 375px;
            min-height: 630px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .calculator-container.flipped {
            transform: rotateY(180deg);
        }

        .calculator, .info-page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            backface-visibility: hidden;
            background-color: var(--calculator-bg);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        .info-page {
            transform: rotateY(180deg);
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
        }

        .theme-toggle-btn, .info-toggle-btn, .back-btn {
            position: absolute;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-color);
            transition: color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .theme-toggle-btn {
            top: 25px;
            right: 25px;
        }
        .info-toggle-btn {
            top: 25px;
            left: 25px;
        }
        .back-btn {
            top: 25px;
            left: 25px;
            z-index: 10;
        }

        .theme-toggle-btn:hover, .info-toggle-btn:hover, .back-btn:hover {
            opacity: 0.8;
        }

        h1 {
            font-size: 24px;
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .display {
            background-color: var(--display-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            word-wrap: break-word;
            /* ÈÄôË£°ÊòØÊñ∞‰∫ìÂõ∫ÂÆöÈ´òÂ∫¶Ë®≠ÂÆö */
            min-height: 180px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: background-color 0.3s;
        }

        #input-display {
            font-family: 'ShangguSerif', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 18px;
            color: #6c757d;
            margin-bottom: 15px; /* Ë™øÊï¥Â∫ïÈÉ®ÈñìË∑ù */
            min-height: 25px;
            text-align: left; /* Èù†Â∑¶Â∞çÈΩä */
            word-break: break-all;
        }
        
        body.dark-mode #input-display {
            color: #a0a0a0;
        }

        #result-display {
            font-family: 'ShangguSerif', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 30px;
            font-weight: bold;
            color: var(--result-color);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-start; /* Èù†Â∑¶Â∞çÈΩä */
            text-align: left; /* Èù†Â∑¶Â∞çÈΩä */
            line-height: 1.2;
            padding-bottom: 10px; /* Â¢ûÂä†Â∫ïÈÉ®ÂÖßÈÇäË∑ù */
        }
        
        #result-display .result-line {
            font-size: 16px;
            color: #555;
            font-weight: normal;
            margin: 0;
            padding: 0;
        }
        
        body.dark-mode #result-display .result-line {
            color: #a0a0a0;
        }

        #result-display .result-main {
            font-size: 30px;
            color: var(--result-color);
            margin: 0;
            padding: 0;
        }
        
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: auto;
        }

        .btn {
            font-family: 'ShangguSerif', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            padding: 18px 0;
            cursor: pointer;
            background-color: var(--button-bg);
            color: var(--text-color);
            transition: background-color 0.2s, transform 0.1s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:hover {
            background-color: var(--button-hover-bg);
        }
        
        .btn:active {
            transform: scale(0.96);
        }

        .btn.operator {
            background-color: var(--operator-bg);
            color: white;
        }
        .btn.operator:hover {
            background-color: var(--operator-hover-bg);
        }

        .btn.equal {
            background-color: var(--equal-bg);
            color: white;
            grid-column: 3 / span 2;
        }
        .btn.equal:hover {
            background-color: var(--equal-hover-bg);
        }
        
        .info-page-content h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        .info-page-content p {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-color);
            opacity: 0.8;
        }
    </style>
</head>
<body>

    <div class="calculator-container" id="calculator-container">
        
        <div class="calculator">
            <button class="info-toggle-btn" id="info-toggle" aria-label="È°ØÁ§∫Ë≥áË®ä">‚ÑπÔ∏è</button>
            <button class="theme-toggle-btn" id="theme-toggle" aria-label="ÂàáÊèõÊ∑±Ëâ≤Ê®°Âºè">üåô</button>
            <h1>ÊΩÆÊ±ïË¶™Â±¨Á®±Ë¨ÇË®àÁÆóÂô®</h1>
            <div class="display">
                <div id="input-display">Êàë</div>
                <div id="result-display"></div>
            </div>
            <div class="buttons">
                <button class="btn operator" data-value="Ê∏ÖÁ©∫">Ê∏ÖÁ©∫</button>
                <button class="btn" data-value="Áà∏">Áà∏</button>
                <button class="btn" data-value="Â™Ω">Â™Ω</button>
                <button class="btn operator" data-value="ÈÄÄÊ†º">‚Üê</button>
                <button class="btn" data-value="ÂÖÑ">ÂÖÑ</button>
                <button class="btn" data-value="Âºü">Âºü</button>
                <button class="btn" data-value="Âßê">Âßê</button>
                <button class="btn" data-value="Â¶π">Â¶π</button>
                <button class="btn" data-value="Â§´">Â§´</button>
                <button class="btn" data-value="Â¶ª">Â¶ª</button>
                <button class="btn" data-value="Â≠ê">Â≠ê</button>
                <button class="btn" data-value="Â•≥">Â•≥</button>
                <button class="btn equal" data-value="=">Ë®àÁÆó</button>
            </div>
        </div>

        <div class="info-page">
            <button class="back-btn" id="back-toggle" aria-label="ËøîÂõûË®àÁÆóÂô®">‚Üê</button>
            <div class="info-page-content">
                <h2>ÊΩÆÊ±ïË¶™Â±¨Á®±Ë¨ÇË®àÁÆóÂô®</h2>
                <p><strong>ÁâàÊú¨Ôºö</strong> V1.0 </p>
                <p><strong>‰ΩúËÄÖÔºö</strong> <a href="https://space.bilibili.com/502920505" target="_blank" style="color: yellow;">Ê≤ôËå∂„Å°„ÇÉ„Çì</a></p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calculatorContainer = document.getElementById('calculator-container');
            const inputDisplay = document.getElementById('input-display');
            const resultDisplay = document.getElementById('result-display');
            const buttons = document.querySelector('.buttons');
            const themeToggleBtn = document.getElementById('theme-toggle');
            const infoToggleBtn = document.getElementById('info-toggle');
            const backToggleBtn = document.getElementById('back-toggle');

            let currentInput = ['Êàë'];

            const pronunciationData = {
                'Áà∏': 'pƒÅ', 'Â™Ω': 'mƒÅ', 'ÂÖÑ': 'hiann', 'Âºü': 'ti', 'Âßê': 'ce', 'Â¶π': 'mue',
                'Â§´': '', 'Â¶ª': 'chi', 'Â≠ê': 'cur', 'Â•≥': '', 'Êàë': 'w√°',
            };
            
            const kinshipMap = new Map();
            kinshipMap.set('Áà∏', { self: 'ÈòøÁàπ / Èòø‰ºØ / ÈòøÂèî', reverse: 'Â≠ê' });
            kinshipMap.set('Â™Ω', { self: 'ÈòøÂ®ò / ÈòøÂßÜ / ÈòøÂß®', reverse: 'Â≠ê' });
            kinshipMap.set('ÂÖÑ', { self: 'ÈòøÂÖÑ', reverse: 'Âºü' });
            kinshipMap.set('Âºü', { self: 'ÈòøÂºü', reverse: 'ÂÖÑ' });
            kinshipMap.set('Âßê', { self: 'ÈòøÂßê', reverse: 'Â¶π' });
            kinshipMap.set('Â¶π', { self: 'ÈòøÂ¶π', reverse: 'Âßê' });
            kinshipMap.set('Â§´', { self: 'ÈòøËÄÅ / ÁøÅ / ËÄÅÁøÅ', reverse: 'Â¶ª' });
            kinshipMap.set('Â¶ª', { self: 'ÈòøËÄÅ / ËÄÅÂ©Ü / Â¨∑', reverse: 'Â§´' });
            kinshipMap.set('Â≠ê', { self: 'ÈÄó‰ªî / ÈòøÂ•¥ / ÈòøÂºü', reverse: 'Áà∏ / Â™Ω' });
            kinshipMap.set('Â•≥', { self: 'Ëµ∞‰ªî / ÈòøÂ¶π', reverse: 'Áà∏ / Â™Ω' });

            const invalidRelationships = [
                'Â§´‰∫ìÂ§´',
                'Â¶ª‰∫ìÂ¶ª'
            ];

            const simplificationRules = {
                'ÂÖÑ‰∫ìÂÖÑ': 'ÂÖÑ',
                'Âºü‰∫ìÂºü': 'Âºü',
                'Âßê‰∫ìÂßê': 'Âßê',
                'Â¶π‰∫ìÂ¶π': 'Â¶π',
                'ÂÖÑ‰∫ìÂºü': 'Âºü',
                'Âºü‰∫ìÂÖÑ': 'ÂÖÑ',
                'Âßê‰∫ìÂ¶π': 'Â¶π',
                'Â¶π‰∫ìÂßê': 'Âßê',
            };

            const relationshipSolver = {
                'Êàë': { self: 'Êàë', reverse: 'Êàë' },
                'Â§´‰∫ìÂ¶ª': { self: 'Êàë', reverse: 'Êàë' }, 'Â§´‰∫ìÁà∏': { self: 'Áà∏', reverse: 'Êñ∞Â¶á' },
                'Â¶ª‰∫ìÂ§´': { self: 'Êàë', reverse: 'Êàë' }, 'Â¶ª‰∫ìÁà∏': { self: '', reverse: 'Â©ø' },
                'Áà∏‰∫ìÁà∏': { self: 'ÂÖ¨', reverse: 'Â≠ô' },
                'Áà∏‰∫ìÂ¶à': { self: 'Â¨§', reverse: 'Â≠ô' },
                'Áà∏‰∫ìÂÖÑ': { self: '‰ºØ', reverse: '' }, 'Áà∏‰∫ìÂÖÑ‰∫ìÁà∏': { self: '‰ºØÂÖ¨', reverse: '' }, 'Áà∏‰∫ìÂÖÑ‰∫ìÂ™Ω': { self: 'Â¨§', reverse: '' }, 'Áà∏‰∫ìÂÖÑ‰∫ìÂ¶ª': { self: 'ÂßÜ', reverse: '' },
                'Áà∏‰∫ìÂºü': { self: 'Âèî', reverse: '' }, 'Áà∏‰∫ìÂºü‰∫ìÁà∏': { self: '‰ºØÂÖ¨', reverse: '' }, 'Áà∏‰∫ìÂºü‰∫ìÂ™Ω': { self: 'Â¨§', reverse: '' }, 'Áà∏‰∫ìÂºü‰∫ìÂ¶ª': { self: 'Â¨∏', reverse: '' },
                'Áà∏‰∫ìÂßê': { self: 'Âßë', reverse: '' }, 'Áà∏‰∫ìÂ¶π': { self: 'ÈòøÂßë', reverse: 'Âß®Âß™' },
                'Áà∏‰∫ìÂßê‰∫ìÂ§´': { self: '‰∏à', reverse: 'Âß®Âß™' }, 'Áà∏‰∫ìÂ¶π‰∫ìÂ§´': { self: 'Èòø‰∏à / ‰∏à', reverse: 'Âß®Âß™' },
                'Â™Ω‰∫ìÂÖÑ': { self: 'ËàÖËàÖ', reverse: 'Â§ñÁî•' }, 'Â™Ω‰∫ìÂºü': { self: 'ËàÖËàÖ', reverse: 'Â§ñÁî•' },
                'Â™Ω‰∫ìÂÖÑ‰∫ìÂ¶ª': { self: 'Â¶ó', reverse: 'Â§ñÁî•' }, 'Â™Ω‰∫ìÂºü‰∫ìÂ¶ª': { self: 'Â¶ó', reverse: 'Â§ñÁî•' },
                'Â™Ω‰∫ìÂßê': { self: 'Âß®', reverse: 'Âß®Áî•' }, 'Â™Ω‰∫ìÂ¶π': { self: 'Âß®', reverse: 'Âß®Áî•' },
                'Â¶ª‰∫ìÁà∏': { self: '‰∏à‰∫∫ / ‰∏à‰∫∫ÂÖ¨', reverse: 'Â•≥Â©ø' }, 'Â¶ª‰∫ìÂ™Ω': { self: '‰∏àÊØç / ‰∏àÊØçÂ©Ü', reverse: 'Â•≥Â©ø' },
                'Â¶ª‰∫ìÂÖÑ': { self: 'Â¶ªËàÖ / ÈòøËàÖ', reverse: 'ÂßêÂ§´' }, 'Â¶ª‰∫ìÂºü': { self: 'Â¶ªËàÖ / ÈòøËàÖ', reverse: 'ÂßêÂ§´' },
                'Â¶ª‰∫ìÂÖÑ‰∫ìÂ¶ª': { self: 'Â¶ªÂ¶ó / ÈòøÂ¶ó', reverse: 'ÂßêÂ§´' }, 'Â¶ª‰∫ìÂºü‰∫ìÂ¶ª': { self: 'Â¶ªÂ¶ó / ÈòøÂ¶ó', reverse: 'ÂßêÂ§´' },
                'Â¶ª‰∫ìÂßê': { self: 'Â¶ªÂß® / ÈòøÂß®', reverse: 'Â¶πÂ§´' }, 'Â¶ª‰∫ìÂ¶π': { self: 'Â¶ªÂß® / ÈòøÂß®', reverse: 'Â¶πÂ§´' },
                'ÂÖÑ‰∫ìÂ¶ª': { self: 'ÈòøÂ´Ç', reverse: 'Â∞èÂèî / Â∞èÂßë' }, 'Âºü‰∫ìÂ¶ª': { self: 'ÂºüÂ©¶', reverse: 'Â§ß‰ºØ / Â§ßÂßë' },
                'Âßê‰∫ìÂ§´': { self: 'ÂßêÂ§´', reverse: 'Â∞èËàÖÂ≠ê / Â§ßËàÖÂ≠ê' }, 'Â¶π‰∫ìÂ§´': { self: 'Â¶πÂ§´ / Â¶πÂ©ø', reverse: 'Â∞èËàÖÂ≠ê / Â§ßËàÖÂ≠ê' },
                'Â≠ê‰∫ìÂ¶ª': { self: 'ÂøÉÂì∫', reverse: 'ÂÖ¨ÂÖ¨ / Â©ÜÂ©Ü' }, 'Â•≥‰∫ìÂ§´': { self: 'ÈòøÈÉé / ‰ªîÂ©ø', reverse: 'Â≤≥Áà∂ / Â≤≥ÊØç' },
                'Á•ñÁà∂': { self: 'ÈòøÂÖ¨', reverse: 'Â≠´ÂÖí' }, 'Á•ñÊØç': { self: 'ÈòøÂ™Ω', reverse: 'Â≠´ÂÖí' },
                'Â§ñÁ•ñÁà∂': { self: 'Â§ñÂÖ¨', reverse: 'Â§ñÂ≠´' }, 'Â§ñÁ•ñÊØç': { self: 'Â§ñÂ™Ω', reverse: 'Â§ñÂ≠´' },
                'Â≠´': { self: 'ÈÄóÂ≠´ / ‰ªîÂ≠´', reverse: 'ÈòøÂÖ¨ / ÈòøÂ™Ω' },
                'Â≠´Â•≥': { self: 'Ëµ∞Â≠´ / ÈòøÂ¶π‰ªî', reverse: 'ÈòøÂÖ¨ / ÈòøÂ™Ω' },
                'Â§ñÂ≠´': { self: 'Â§ñÂ≠´', reverse: 'Â§ñÂÖ¨ / Â§ñÂ©Ü' },
                'Â§ñÂ≠´Â•≥': { self: 'Â§ñÂ≠´Â•≥', reverse: 'Â§ñÂÖ¨ / Â§ñÂ©Ü' },
                'ÊõæÂ≠´': { self: 'ÈÄóÊõæÂ≠´', reverse: 'Â§™ÂÖ¨ / Â§™Â™Ω' },
                'ÊõæÂ≠´Â•≥': { self: 'Ëµ∞ÊõæÂ≠´', reverse: 'Â§™ÂÖ¨ / Â§™Â™Ω' },
                'ÁéÑÂ≠´': { self: 'ÈÄóÁéÑÂ≠´', reverse: 'ÈòøÁ•ñ' },
                
                
            };

            const formatWithRuby = (text, pinyin) => {
                let formattedHtml = '';
                const words = text.split(' / ');
                const pinyins = pinyin.split(' / ');
                words.forEach((word, index) => {
                    if (word.trim()) {
                        const wordPinyin = pinyins[index] || '';
                        formattedHtml += `<ruby>${word}<rt>${wordPinyin}</rt></ruby>`;
                        if (index < words.length - 1) {
                            formattedHtml += ' / ';
                        }
                    }
                });
                return formattedHtml;
            };

            const updateDisplay = () => {
                let formattedInput = 'Êàë';
                if (currentInput.length > 1) {
                    formattedInput = currentInput.join('‰∫ì');
                }
                inputDisplay.textContent = formattedInput;
            };
            
            const findRelationship = (inputChain) => {
                const chainString = inputChain.slice(1).join('‰∫ì');
                
                // 1. ÁÑ°ÊïàÈóú‰øÇÊ™¢Êü•
                for (const invalidRule of invalidRelationships) {
                    if (chainString.includes(invalidRule)) {
                        return { error: 'ÁÑ°ËÆäÈ°ØÁ§∫ÂêåÊÄßÈóú‰øÇ' };
                    }
                }

                // 2. Â±§Êï∏Ê™¢Êü•
                if (inputChain.length - 1 > 5) {
                    return { error: 'ÈÅéÈï∑Â∞±ÊâæÊØãÁùÄÂìá!' };
                }

                // 3. Á∞°ÂåñËôïÁêÜ
                let simplifiedString = chainString;
                let hasSimplified = true;
                
                while (hasSimplified) {
                    hasSimplified = false;
                    for (const rule in simplificationRules) {
                        if (simplifiedString.includes(rule)) {
                            simplifiedString = simplifiedString.replace(rule, simplificationRules[rule]);
                            hasSimplified = true;
                            break; 
                        }
                    }
                }

                // 4. Á≤æÁ¢∫ÂåπÈÖç
                if (relationshipSolver[simplifiedString]) {
                    const result = relationshipSolver[simplifiedString];
                    return {
                        self: result.self,
                        reverse: result.reverse,
                        selfPinyin: pronunciationData[result.self] || '',
                        reversePinyin: pronunciationData[result.reverse] || ''
                    };
                }
                
                // 5. ÈÄöÁî®ÂåπÈÖç (ÂñÆÂ±§Èóú‰øÇ)
                if (kinshipMap.has(simplifiedString)) {
                    const data = kinshipMap.get(simplifiedString);
                    return {
                        self: data.self,
                        reverse: data.reverse,
                        selfPinyin: pronunciationData[data.self] || '',
                        reversePinyin: pronunciationData[data.reverse] || ''
                    };
                }

                // 6. ÊúÄÁµÇÈåØË™§
                return { error: 'ÈÅéÈï∑Â∞±ÊâæÊØãÁùÄÂìá!' };
            };

            const calculate = () => {
                if (currentInput.length <= 1) {
                    resultDisplay.innerHTML = '';
                    return;
                }

                const result = findRelationship(currentInput);

                if (result.error) {
                    resultDisplay.innerHTML = `<div class="result-main">${result.error}</div>`;
                } else {
                    const selfCallText = result.self;
                    const reverseCallText = result.reverse;
                    const selfPinyin = result.selfPinyin || pronunciationData[selfCallText] || '';
                    const reversePinyin = result.reversePinyin || pronunciationData[reverseCallText] || '';
                    
                    resultDisplay.innerHTML = `
                        <div class="result-line">ÊàëÁ®±ÂëºÂ∞çÊñπÔºö</div>
                        <div class="result-main">${formatWithRuby(selfCallText, selfPinyin)}</div>
                        <div class="result-line">Â∞çÊñπÁ®±ÂëºÊàëÔºö</div>
                        <div class="result-main">${formatWithRuby(reverseCallText, reversePinyin)}</div>
                    `;
                }
            };
            
            const clear = () => {
                currentInput = ['Êàë'];
                updateDisplay();
                resultDisplay.innerHTML = '';
            };

            const backspace = () => {
                if (currentInput.length > 1) {
                    currentInput.pop();
                    updateDisplay();
                }
            };

            buttons.addEventListener('click', (event) => {
                if (!event.target.classList.contains('btn')) return;

                const value = event.target.dataset.value;

                switch (value) {
                    case '=':
                        calculate();
                        break;
                    case 'Ê∏ÖÁ©∫':
                        clear();
                        break;
                    case 'ÈÄÄÊ†º':
                        backspace();
                        break;
                    default:
                        currentInput.push(value);
                        updateDisplay();
                        resultDisplay.innerHTML = '';
                        break;
                }
            });

            const toggleDarkMode = () => {
                const isDarkMode = document.body.classList.toggle('dark-mode');
                if (isDarkMode) {
                    document.body.classList.remove('light-mode');
                    themeToggleBtn.textContent = '‚òÄÔ∏è';
                } else {
                    document.body.classList.add('light-mode');
                    themeToggleBtn.textContent = 'üåô';
                }
                localStorage.setItem('darkMode', isDarkMode);
            };

            themeToggleBtn.addEventListener('click', toggleDarkMode);
            infoToggleBtn.addEventListener('click', () => {
                calculatorContainer.classList.add('flipped');
            });
            backToggleBtn.addEventListener('click', () => {
                calculatorContainer.classList.remove('flipped');
            });

            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedMode = localStorage.getItem('darkMode');

            if (savedMode === 'true' || (savedMode === null && prefersDark)) {
                document.body.classList.add('dark-mode');
                themeToggleBtn.textContent = '‚òÄÔ∏è';
            } else {
                document.body.classList.add('light-mode');
                themeToggleBtn.textContent = 'üåô';
            }

            clear();
        });
    </script>
</body>
</html>